<!-- content projection to be used in error handler -->
  <ng-container login-content>
 <!-- rendered content -->
 @defer {
<form [formGroup]="loginForm" (ngSubmit)="login()">
  <div class="login-header">
    <!-- logo glows on valid login -->
    <div logo>
    <img ngSrc="assets/images/Skalar_Hat_Icon.png" 
    ngSrcset="100w, 200w, 300w" sizes="50vw"
    loading="eager"
    width="94.5" height="75"
    alt="Skalar Grad Wizard Hat Icon">
     </div>
  <h2> Enhance Your Academic Experience With <br>
    <div skalarly>
      Skalarly
      </div>
  </h2>
  </div>
  <div class="input-boxes" >
    <div>
<span inputs>
    <div column>
  <!-- enter email -->
  <mat-form-field  appearance="outline" >
    <input matInput formControlName="email"  placeholder="ex: name@institution.ca" type="email"
    id="skalarlyEmail" [appGlowBorder]="isGlowing" />
    <mat-label [class.condition-met]="emailFound" >
         Academic Email</mat-label>
    <mat-error *ngIf="loginForm.get('email')!.invalid">No account matches this email</mat-error>
  <mat-icon matPrefix class="material-symbols-outlined" 
    [@spinAndChange]="emailState">
    /move to async pipe
    <div *ngIf="(email$ | async); else more"></div>
    @switch (emailState) {
      @case ('initial') { alternate_email }
      @case ('spinning') { alternate_email }
      @case ('check') { check_circle }
    }
  </mat-icon>
  </mat-form-field>
  <div class="login-options">
    <!-- Keep skalar logged in -->
    <mat-checkbox [checked]="stayLoggedIn" (change)="stayIn()" >
     <app-letter-by-letter [customClass]="'small'"
     [message]="stayLogIn"
     [autoGenerate]="false"
     [welcomeSouthPaw]="false">
     </app-letter-by-letter>
    </mat-checkbox>
    </div>
    </div>
  <div column>
   <!-- enter password -->
  <mat-form-field appearance="outline">
    <span matPrefix class="material-symbols-outlined"
    [@lock]="lockState" placeholder="Password" >
    <mat-icon>
      {{ !isPasswordValid ? 'lock' : 'lock_open' }}
    </mat-icon>
      </span>
 <input matInput formControlName="password" placeholder="Password" 
 [type]="visiblePassword ? 'text' : 'password'"
 #skalarlyPassword [appGlowBorder]="isGlowing" />
 <mat-label [class.condition-met]="loginForm.get('password')!.valid">
   Password</mat-label>
 <mat-error *ngIf="loginForm.get('password')!.invalid">Invalid password</mat-error>
<button matSuffix mat-icon-button type="button"
(click)="$event.stopPropagation(); toggleVisibility()" [@rotate180]="visiblePassword"
matTooltip="{{ visiblePassword ? 'Hide Password' : 'Show Password' }}" >
<span class="material-symbols-outlined">
    <mat-icon>
    {{ visiblePassword ? 'visibility' : 'visibility_off' }}
    </mat-icon>
</span>
</button>
</mat-form-field>
<!-- forgot password -->
<div forgot>
<button type="button" (click)="navigate()" forgot>
  <app-letter-by-letter
  [customClass]="'small'" [message]="forgot" [autoGenerate]="false" [welcomeSouthPaw]="false"></app-letter-by-letter>
</button>
</div>
</div>
</span>

<!-- Login Button -->
<div loginButton >
  @switch (progressState) {
    @case ('default') {
  <button mat-fab  type="submit" class="material-symbols-outlined"
  [@fingerprintActivation]="loginForm.valid ? 'activated' : 'normal' "
  [@dissolve]="progressState"
  [@shake]="failedLoginAnimation"
  (keydown.enter)="enterClicked()">
  <span [class.border-element]="nextAnimations">
    fingerprint
  </span>
  </button>

}
<!-- Processing login -->
  @case ('loading') {
<button mat-raised-button [@authenticatingGlow]="progressState">
  <span>Authenticating</span>
  <div class="dot-pulse-container">
@for (dot of dots; track dot){
    <span class="dot-pulse"></span>
}
    </div>
</button>
}
<!-- approved -->
  @case ('complete') {
<button mat-icon-button [@fadeInGrow] class="material-symbols-outlined glowing-text">
 approval_delegation
</button>
}
  }
</div>
</div>
</div>
</form>
<!-- welcome and join animation -->
<div class="welcome-container">
  <button mat-raised-button 
   routerLink="/sign-up" join>
@if (!nextAnimations) {
  <span>Join</span>
} @else {
  <app-letter-by-letter [customClass]="'small'"
   [message]="join" [autoGenerate]="false" [@bubble]="'animate'" 
  [welcomeSouthPaw]="true"></app-letter-by-letter>
  }
  </button>
<!-- array animation of words -->
    <div [@welcomeRise]="skalarlyState ? 'rise' : 'initial' "
    (@welcomeRise.done)="welcomeRiseDone()" >
  <app-letter-by-letter 
   [customClass]="'large'"
   [message]="welcome"
   [autoGenerate]="true" 
   [welcomeSouthPaw]="false" 
  ></app-letter-by-letter>
  </div>
</div>
} @loading {
  <form>
    <div column>
   <!-- pre load skeleton -->
      <app-skeleton-loader-login></app-skeleton-loader-login>
      </div>
      </form>
}
</ng-container>
